# coding: utf-8

# Этот скрипт добавляет экран выбора языка в Ren'Py 8.4+
# и интегрирует его в стандартный экран настроек.

# Используем `init` с низким приоритетом, чтобы наш код выполнился
# после определения стандартных экранов Ren'Py.
init -2 python:

    # --- Шаг 1: Конфигурация языков ---
    # Определяем список доступных языков.
    # Первый язык в списке будет языком по умолчанию.
    # Формат: ("Название в меню", "идентификатор_языка")
    # `None` используется для стандартного (английского) языка.
    config.languages = [
        ("English", None),
        ("Русский", "russian")
    ]

    # Создадим словарь для удобного получения названия языка по его идентификатору.
    language_names = {identifier: name for name, identifier in config.languages}

    # --- Шаг 2: Интеграция в меню настроек ---
    # Добавляем новую опцию в экран настроек.
    # Это современный способ, заменяющий устаревший `config.preferences`.
    config.preferences.add(
        # Надпись для нашей опции.
        _("Language"),
        # Значение, которое будет отображаться рядом (текущий язык).
        language_names.get(persistent.language, "English"),
        # Действие при нажатии — открыть наш экран выбора языка.
        ShowMenu("language_screen")
    )


# --- Шаг 3: Создание экрана выбора языка ---
screen language_screen():

    # Используем стандартный шаблон игрового меню для единообразного вида.
    # Первый аргумент — это заголовок экрана.
    tag menu
    use game_menu(_("Language"), scroll="viewport"):

        # Вертикальный блок для размещения кнопок.
        vbox:
            style "menu_vbox"
            xalign 0.5
            yalign 0.5

            # Создаем кнопки для каждого языка из нашего списка.
            for name, identifier in config.languages:

                # Кнопка с названием языка.
                textbutton name:
                    style "menu_textbutton"
                    action Language(identifier)

                    # Подсвечиваем кнопку, если этот язык выбран в данный момент.
                    selected (persistent.language == identifier)

            # Кнопка для возврата на предыдущий экран (настройки).
            textbutton _("Close"):
                style "menu_textbutton"
                action Return()


# --- Шаг 4: Перевод строк, используемых в этом скрипте ---
translate russian strings:
    "Language": "Язык"
    "Close": "Закрыть"
    # Названия языков можно оставить как есть или перевести.
    "English": "English"
    "Русский": "Русский"


# --- Шаг 5: Установка языка по умолчанию ---
# Если `persistent.language` еще не установлен, Ren'Py автоматически
# использует первый язык из `config.languages` (в нашем случае — английский).
# Таким образом, эта строка гарантирует, что при первом запуске
# переменная будет инициализирована правильно.
default persistent.language = None
